name: Deploy AI App

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
    - name: Update and deploy application
      run: |
        set -e
        echo 'ðŸš€ Starting deployment...'
        cd /opt/ai-app
        
        echo '=== Pulling latest code ==='
        git pull origin main
        
        echo '=== Stopping existing containers ==='
        docker compose down || true
        
        echo '=== Building and starting services ==='
        docker compose up -d --build
        
        echo '=== Waiting for services ==='
        sleep 30
        
        echo '=== Verification ==='
        docker compose ps
        curl -f http://localhost:8000/health && echo 'âœ… Backend healthy'
        curl -f http://localhost:5000/health && echo 'âœ… Frontend healthy'
        
        echo 'ðŸŽ‰ Deployment completed!'
